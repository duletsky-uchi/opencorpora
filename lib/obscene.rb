# Детектирование обсцентной лексики
#
# прекрасный обзор с мимногоязычными мини-словарями
# https://writers.fandom.com/ru/wiki/Обсценная_лексика
#
# интересные образцы лексики XIX века
# http://plutser.ru/slovari_mata/slovar1865/
module Obscene
  require 'text'

  # чем длиннее слово - тем больше в нем может быть ошибок
  # число ошибок
  ERROR_TOLERANCE = 1
  # на число знаков
  CHARS_ON_ERROR = 6
  # макс.длина слов которые не проверяются на подобие
  SHORT_WORD_LENGTH = 2

  # макс.длина слов которые не проверяются на подобие
  TRIGRAM_MIN = 0.54

  def self.stop_words
    @stop_words ||= %w[
        6лядь
        6лять
        b3ъeб
        cock
        cunt
        e6aль
        ebal
        eblan
        eбaл
        eбaть
        eбyч
        eбать
        eблантий
        eбёт
        fuck
        fucker
        fucking
        xyй
        xyя
        xyёв
        xуе
        xуй
        xую
        zaeb
        zaebal
        zaebali
        zaebat
        абдристаться
        абосранец
        абосрать
        абосцать
        абосцаться
        абсирать
        абъебос
        абьебать
        абьебос
        аднохуйственно
        анал
        анальный
        анус
        апездал
        апизде
        архипиздрит
        ауе
        аужо
        ахуел
        ахуенный
        ахуетительный
        ахуеть
        бабушкоёб
        баребух
        беспесды
        бздение
        бздеть
        бздех
        бздецы
        бздит
        бздицы
        бздло
        бзднуть
        бздун
        бздунья
        бздюха
        бздюшка
        бздюшко
        блеать
        блеать
        блиать
        блэт
        бля
        бля
        блябу
        блябуду
        бляд
        бляди
        блядина
        блядище
        блядки
        блядовать
        блядство
        блядун
        блядуны
        блядунья
        блядь
        блядюга
        блять
        бодидилда
        болтзабей
        болттебеврот
        валагалишна
        вафел
        вафлер
        вафлёр
        вглазъебись
        вертохуй
        вжопутрах
        взъебка
        взьебка
        взьебывать
        вибратор
        впопутрах
        вротебись
        вторсырьёб
        въеб
        въебался
        въебенн
        въебусь
        въебывать
        выблядок
        выблядыш
        выблядышь
        выеб
        выебать
        выебен
        выебнулся
        выебон
        выебываться
        выпердеть
        выпердыш
        вырвихуй
        высер
        высраться
        выссаться
        вьебать
        вьебен
        гавно
        гавно
        гавно
        гавноед
        гавноед
        гавножоп
        гавножор
        гавнонюх
        гавнюк
        гавнюк
        гавнючка
        гамно
        гандон
        гей
        гитлер
        гнид
        гнида
        гнида
        гниды
        говенка
        говенный
        говешка
        говназия
        говнецо
        говнище
        говно
        говнобот
        говноед
        говнолинк
        говномес
        говночист
        говнюк
        говнюха
        говнядина
        говняк
        говняный
        говнять
        голожопик
        гомик
        гондон
        давалка
        дандрик
        данунах
        дапохуй
        дерьмодемон
        дерьмодемон
        джигурда
        дилдо
        дилдоболдушка
        дилдос
        длиннохуй
        доебываться
        долбоеб
        долбоящер
        долбоёб
        дохлятина
        драчи
        дрисня
        дрист
        дристануть
        дристать
        дристун
        дристуха
        дрочелло
        дрочена
        дрочер
        дрочила
        дрочила
        дрочилка
        дрочило
        дрочистый
        дрочить
        дрочка
        дрочун
        дрочь
        дура
        дювельшайс
        е6ал
        е6ут
        еб
        ебaть
        ебyч
        ебал
        ебалай
        ебало
        ебальник
        ебан
        ебанамать
        ебанат
        ебанашка
        ебаная
        ебанический
        ебанный
        ебанныйврот
        ебаное
        ебанутый
        ебануть
        ебануться
        ебанушка
        ебаный
        ебанько
        ебарь
        ебасос
        ебат
        ебатория
        ебать
        ебать-копать
        ебаться
        ебашить
        ебет
        ебет
        ебец
        ебик
        ебин
        ебись
        ебическая
        ебический
        ебический
        ебки
        ебла
        еблан
        ебланище
        еблет
        ебливый
        еблиссимо
        еблище
        ебло
        еблыст
        ебля
        ебнуть
        ебнуться
        ебня
        ебонтяй
        ебонько
        ебосос
        ебошить
        ебошишь
        ебская
        ебский
        ебтвоюмать
        ебу
        ебун
        ебурашка
        ебут
        ебуч
        ебуче
        ебучее
        ебучие
        ебучий
        ебучим
        ебучка
        ебучка
        ебущ
        ебырь
        ебёна
        ебёт
        ебёт
        елда
        елдак
        елдачить
        ептваюмать
        ептвоюмать
        жид
        жирножоп
        жопа
        жопотрах
        жопошлёп
        жопу
        заговнять
        задрачивать
        задристать
        задрота
        зае6
        заеб
        заеба
        заебал
        заебалась
        заебали
        заебанец
        заебастая
        заебастый
        заебать
        заебаться
        заебашить
        заебистое
        заебистые
        заебистый
        заебись
        заебло
        заебок
        заебошить
        заебца
        заебываться
        заебыш
        залуп
        залупа
        залупа
        залупаться
        залупить
        залупиться
        залупка
        замудохаться
        запиздячить
        засерать
        засерун
        засеря
        засирать
        засранцы
        засрун
        захуячить
        заябестая
        заё6
        заёб
        заёбистое
        заёбистые
        заёбистый
        злоеб
        злоебучая
        злоебучее
        злоебучий
        зоофил
        ибанамат
        иблище
        ибонех
        изврат
        изговнять
        изговняться
        изъебнуться
        импотент
        инцест
        ипать
        ипаться
        ипаца
        ипацца
        ипаццо
        испражнюля
        испражнялка
        йобанат
        йобаныйврот
        йух
        какдвапальцаобоссать
        калоед
        калосборник
        клитор
        кобелина
        кобельебливый
        ковырялка
        конча
        кончеглот
        конченая
        кончилвглаз
        кончилвзад
        крысоёб
        курва
        курвятник
        кутак
        кутак баш
        лох
        лохи
        лошарa
        лошара
        лошары
        лошок
        лошпед
        лужаспермы
        лярва
        мазафака
        малафья
        мамкоеб
        мамоёб
        манда
        мандавошек
        мандавошка
        мандавошки
        манде
        мандей
        мандень
        мандеть
        мандища
        мандой
        манду
        мандюк
        мартышлюшка
        мастурбатор
        менструха
        микрохер
        минет
        минетчик
        минетчица
        миньет
        млять
        мокрощелка
        мокрощёлка
        мокрощёлка
        мохнатка
        мочесборник
        мразина
        мразопися
        мразота
        мразь
        мудak
        мудaк
        мудаг
        мудак
        муде
        мудель
        мудеть
        муди
        мудил
        мудила
        мудило
        мудистый
        мудня
        мудоеб
        мудозвон
        мудоклюй
        набздел
        набздеть
        наговнять
        надристать
        надрочить
        наебали
        наебать
        наебет
        наебнуть
        наебнуться
        наебывать
        напиздел
        напиздели
        напиздело
        напиздили
        насрать
        настопиздить
        нах
        нахер
        нахпошёл
        нахпшёл
        нахрен
        нахуй
        нахуй
        нахуй
        нахуйник
        невротебучий
        невстал
        невъебенно
        недотрах
        неебический
        неибучий
        некрофил
        нехира
        нехрен
        нехуй
        нехуйственно
        нигер
        ниибацо
        ниипацца
        ниипаццо
        ниипет
        никробот
        никуя
        нихера
        нихуя
        нихуясе
        обдристаться
        обкончал
        обмудок
        обосранец
        обосрать
        обосцать
        обосцаться
        обсирать
        обсосня
        объеб / обьеб
        объебос
        объебос
        объёбок
        обьебать обьебос
        однохуйственно
        опездал
        опизде
        опизденивающе
        орал
        оргия
        остоебенить
        остопиздеть
        отмудохать
        отпиздить
        отпиздячить
        отпороть
        отрыжка
        отсос
        отсосиновик
        отсосник
        отсосыш
        отъебись
        охуевательский
        охуевать
        охуевающий
        охуел
        охуена
        охуенно
        охуенный
        охуеньчик
        охуеть
        охуительно
        охуительный
        охуяньчик
        охуячивать
        охуячить
        очкун
        падла
        падла
        падонки
        падонок
        параша
        паскуда
        педерас
        педик
        педики
        педор
        педор
        педофил
        педрик
        педрила
        педрилло
        педрило
        педрилы
        пезда
        пездануть
        пездень
        пездеть
        пездит
        пездишь
        пездо
        пездоглаз
        пездят
        пейкончу
        пердак
        пердак
        пердануть
        пердеж
        пердение
        пердеть
        пердильник
        перднуть
        пердолится
        пердун
        пердунец
        пердунина
        пердунья
        пердуха
        пердь
        пердёжник
        переёбок
        пернуть
        петушара
        пздц
        пи3д
        пи3де
        пи3ду
        пиzдец
        пидар
        пидарaс
        пидараcы
        пидарас
        пидарасы
        пидарство
        пидары
        пидераст
        пидерасты
        пидор
        пидорасы
        пидорка
        пидорок
        пидоры
        пидр
        пидр
        пидрас
        пидрила
        пизда
        пиздабол
        пиздализ
        пиздануть
        пиздануться
        пиздапроебище
        пиздарваньчик
        пиздато
        пиздатое
        пиздатый
        пизденка
        пизденыш
        пиздеть
        пиздец
        пиздит
        пиздить
        пиздиться
        пиздишь
        пиздища
        пиздище
        пиздобол
        пиздоболы
        пиздобратия
        пиздоватая
        пиздоватый
        пиздоглазие
        пиздодуй
        пиздокрыл
        пиздолиз
        пиздолиз
        пиздонутые
        пиздонюх
        пиздопроебина
        пиздорванец
        пиздорванка
        пиздострадатель
        пизду
        пиздуй
        пиздун
        пиздунья
        пизды
        пиздюга
        пиздюк
        пиздюлина
        пиздюля
        пиздят
        пиздячить
        пиздёныш
        пиндос
        пиписюн
        писбшки
        писос
        писька
        писькострадатель
        писюн
        писюнчик
        писюшка
        пися
        подговнять
        подзалупный творожок
        подонки
        подонок
        подъебнуть
        подъебнуться
        поебали
        поебать
        поебень
        порнушка
        порнушка
        поскуда
        посрать
        потаскуха
        потаскушка
        похер
        похерил
        похерила
        похерили
        похеру
        похрен
        похрену
        похуист
        похуистика
        похуистка
        похуй
        похуй
        похую
        поёбываает
        придурок
        приебаться
        припиздень
        припизднутый
        припиздюлина
        припёзднутый
        пробзделся
        проблядь
        проеб
        проебанка
        проебать
        промандеть
        промудеть
        пропизделся
        пропиздеть
        пропиздячить
        проститутка
        прошмандовка
        пукан
        пшёлнах
        пёздочка
        пёрднуть
        пёрнуть
        раздолбай
        разхуячить
        разъеб
        разъеба
        разъебай
        разъебать
        распердак
        распидарасило
        распиздай
        распиздеться
        распиздяй
        распиздяйство
        распроеть
        растыка
        рукожоп
        самотык
        самсебяк
        сатана
        свиноматка
        сволота
        сволочь
        сговнять
        секель
        секстинг
        серун
        серька
        сестроеб
        сикель
        сила
        сирать
        сирывать
        сискочлен
        сиська
        сиська
        сиськолиз
        скорострел
        слоноёб
        смазка
        смрадожоп
        сооока
        соси
        спермаглот
        спермаглот
        спермупей
        спидозина
        спиздел
        спиздеть
        спиздил
        спиздила
        спиздили
        спиздит
        спиздить
        срака
        сракотан
        сраку
        сраный
        срань
        сранье
        срать
        срун
        ссака
        ссань
        ссышь
        стерва
        страпон
        страхолюдина
        страхопиздище
        сука
        сукец
        суки
        сукинсын
        суходрочка
        сучара
        сучий
        сучка
        сучко
        сучонок
        сучье
        сцание
        сцать
        сцука
        сцуки
        сцуко
        сцуконах
        сцуль
        сцыха
        сцышь
        съебаться
        сыкердык
        сыкло
        сыкун
        тварь
        теребонькать
        травокур
        трахае6
        трахаеб
        трахальщик
        трахатель
        трахаёб
        трипер
        тройничок
        тройничокс
        трупоеб
        трупоед
        трупоёб
        трупоёбина
        туда-сюда
        ублюдок
        уеба
        уебать
        уебище
        уебищное
        уебк
        уебки
        уебок
        урюк
        усраться
        ушлепок
        уёбища
        уёбище
        уёбищное
        уёбки
        уёбок
        факамака
        фаллоимитатор
        фаллос
        фаллос
        фалос
        флексить
        х_у_я_р_а
        хyй
        хyйня
        хyё
        хайльгитлер
        хамло
        хентай
        хер
        херня
        херня
        херовато
        херовина
        херовый
        херотень
        херушки
        хитровыебанный
        хитрожопый
        хня
        хуeвенько
        хуeм
        хуе
        хуевато
        хуевенькая
        хуевенький
        хуевертить
        хуевина
        хуево
        хуевый
        хуек
        хуекрут
        хуел
        хуем
        хуемое
        хуемразь
        хуенч
        хуеныш
        хуенький
        хуеплет
        хуеплёт
        хуепромышленник
        хуерага
        хуерик
        хуерыга
        хуерыло
        хуесос
        хуесосить
        хуесоска
        хуесосы
        хуета
        хуетень
        хуею
        хуи
        хуиплет
        хуисосить
        хуита
        хуище
        хуй
        хуйзнает
        хуйком
        хуйло
        хуйня
        хуйпиздасковорода
        хуйрик
        хуля
        хую
        хую
        хуюл
        хуя
        хуяк
        хуякать
        хуякнуть
        хуяра
        хуясе
        хуясе
        хуяч
        хуячить
        хуё
        хуёв
        хуёвенький
        хуёвенько
        хуёво
        хуёвый
        хуёк
        целка
        членодевка
        членомордый
        членоносец
        членосос
        чмо
        чмошник
        чмырдяй
        чмырь
        чпокнуть
        шаболда
        шаболда
        шалава
        шалава
        шалавой
        шамотра
        шараёбиться
        шароебиться
        шлюх
        шлюха
        шлюхе
        шлюхи
        шлюху
        шлюхам
        шлюхах
        шлюхой
        шлюхою
        шлюхами
        шлюшка
        шлюшкам
        шлюшках
        шлюшками
        шмара
        шмарам
        шмарах
        шмарами
        шмарина
        шмонька
        шпили-вили
        эбанутый
        ябывает
        яебу
        ёб
        ёбaн
        ёбаная
        ёбаную
        ёбат
        ёбн
        ёбнутый
        ёбырь
        ёпт
        ёпта
        хуёвая
        хуёво
        хуёвого
        хуёвого
        хуёвое
        хуёвой
        хуёвой
        хуёвом
        хуёвому
        хуёвою
        хуёвую
        хуёвые
        хуёвый
        хуёвым
        хуёвым
        хуёвыми
        хуёвых
    ].map { |s| word_normalize(s) }
     .uniq
  end

  # максимальное число ошибок в слове, которое позволяет его еще идентифицировать
  # при 2 'пример' == 'трипер'
  def self.word_normalize(word)
    word
      .downcase
      .downcase.squeeze('А-Яа-яA-z')
      .gsub(/[ъь]/, '')
  end

  def self.is?(wild_word)
    return true if stop_words.include?(wild_word)
    return false if wild_word.size <= SHORT_WORD_LENGTH

    word = word_normalize(wild_word)

    !stop_words
       .detect { |stop| distance(word, stop) && similarity(word, stop) }
       .nil?
  end

  # https://pganalyze.com/blog/similarity-in-postgres-and-ruby-on-rails-using-trigrams
  def self.trigram(word)
    return [] if word.strip == ""

    parts = []
    padded = "  #{word} ".downcase
    padded.chars.each_cons(3) { |w| parts << w.join }
    parts
  end

  # https://pganalyze.com/blog/similarity-in-postgres-and-ruby-on-rails-using-trigrams
  def self.similarity(word1, word2)
    tri1 = trigram(word1)
    tri2 = trigram(word2)

    # return 0.0 if [tri1, tri2].any? { |arr| arr.size == 0 }
    return false if [tri1, tri2].any? { |arr| arr.size == 0 }

    # Find number of trigrams shared between them
    same_size = (tri1 & tri2).size
    # Find unique total trigrams in both arrays
    all_size = (tri1 | tri2).size

    same_size.to_f / all_size > TRIGRAM_MIN
  end

  def self.distance(normal_word, stop)
    # можно ускорить просто считая число несопоставившихся знаков
    distance = Text::Levenshtein.distance(normal_word, stop)
    tolerance = (normal_word.size / CHARS_ON_ERROR) * ERROR_TOLERANCE
    distance <= tolerance
  end
end
